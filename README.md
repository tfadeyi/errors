<div align="center">

# go-aloe
[![Continuous Integration](https://img.shields.io/github/actions/workflow/status/tfadeyi/go-aloe/ci.yml?branch=main&style=for-the-badge)](https://github.com/tfadeyi/go-aloe/actions/workflows/ci.yml)
[![License](https://img.shields.io/badge/License-MIT-yellowgreen.svg?style=for-the-badge)](https://github.com/tfadeyi/go-aloe/blob/main/LICENSE)
[![Language](https://img.shields.io/github/go-mod/go-version/tfadeyi/go-aloe?style=for-the-badge)](https://github.com/tfadeyi/go-aloe)
[![Go Report Card](https://goreportcard.com/badge/github.com/tfadeyi/go-aloe?style=for-the-badge)](https://goreportcard.com/report/github.com/tfadeyi/go-aloe)

</div>

---

Aloe is an easy-to-use Go library for wrapping and handling errors, to provide applications' users with additional context, when encountering errors.
The errors are defined using the [Aloe specification](schema/README.md), this can be written manually or autogenerated using tools
like the [aloe-cli](https://github.com/tfadeyi/aloe-cli).

> The [CLI](https://github.com/tfadeyi/aloe-cli) tool allows to define the errors definitions within the source code
> rather than manually in a separate specification file, this will be auto-generated.

The error definitions file is then stored at the application root level, and passed to the application at runtime.

> âš  The project is currently under development.

## Features

- Easy to embed in existing applications.
- Wrap and give additional context to existing application errors, to improve user experience.
- Link wrapped errors to dedicated error pages on static websites (hosted on github pages). 
- Support writing the Aloe specification in yaml,json and toml formats.

## Installation

To use **go-aloe**, you need to have Go installed. Then, you can install the library using the following command:

```bash
go get -u github.com/tfadeyi/go-aloe@latest
```

## Usage

### With the aloe-cli

Download the latest release of the [aloe-cli](https://github.com/tfadeyi/aloe-cli).
You can then start defining the different error definitions you want for your application by adding them as annotations in your source code.
```go
// @aloe code clean_artefacts_error
// @aloe title Error Removing Previous Artefacts
// @aloe summary The tool has failed to delete the artefacts from the previous execution.
// @aloe details The tool has failed to delete the artefacts from the previous execution.
// Try manually deleting them before running the tool again.
```
More information about the annotations can be found [here](https://github.com/tfadeyi/aloe-cli/README.md#Annotations).  

You can then run the aloe-cli to auto generate an aloe specification for your application that will be used at runtime.

```shell
aloe-cli spec generate main.go
```

<details>
    <summary>auto generated specification</summary>

```yaml
base_url: https://tfadeyi.github.io
description: Generate Sloth SLO/SLI definitions from code annotations.
errors_definitions:
    clean_artefacts_error:
        code: clean_artefacts_error
        details: |-
            The tool has failed to delete the artefacts from the previous execution.
            Try manually deleting them before running the tool again.
        summary: The tool has failed to delete the artefacts from the previous execution.
        title: Error Removing Previous Artefacts
    unsupported_language:
        code: unsupported_language
        details: |-
            The source language passed to the --lang flag is not currently supported by the tool.
            The following are the supported languages: go, wasm(experimental).
        summary: The language passed to the --lang flag is not supported.
        title: Unsupported Language Error
    unsupported_output_format:
        code: unsupported_output_format
        details: |-
            The format passed to the --lang flag is not currently supported by the tool.
            The following are the supported languages: yaml(default), json.
        summary: The format passed to the --format flag is not supported.
        title: Unsupported Output Format Error
    write_artefacts_error:
        code: write_artefacts_error
        details: The tool has failed to print out the Sloth definitions for service.
        summary: The tool has failed to print out the Sloth definitions for service.
        title: Error Creating Artefacts
name: slotalk
version: v0.0.1
```
</details>

### Without the aloe-cli tool
Define an Aloe specification for your application, this will contain all the error definitions for your applications.
Save the specification, under the application current working directory, with `default.aloe.toml` as the file name.

```toml
BaseUrl = "https://github.com/tfadeyi/my-app"
Description = "Sample application"
Name = "my-app"
Title = "My Application"
Version = "v0.0.1"

[ErrorsDefinitions]
    [ErrorsDefinitions.error_something_code]
    code = "error_something_code"
    summary = "This is a summary of the error that will wrap the application error."
    title = "Error On Something"
```

For more info on the Aloe specification check the schema [README](schema/README.md).

Import the library into your Go code:

```go
import "github.com/tfadeyi/go-aloe"
```

Now, you can use the library's functions and types in your code.
The following is a simple example showing how an application error is wrapped using the `go-aloe`:

```go
    package main
    
    import (
        "errors"
        "log"
    
        "github.com/tfadeyi/go-aloe"
    )
    
    func doSomething() error {
        err := errors.New("something")
        return goaloe.DefaultOrDie().Error(err, "error_something_code")
    }
    func main() {
        err := doSomething()
        if err != nil {
            log.Fatal(err)
        }
    }
```

Running the code will result with error being thrown containing more context for the user:

```text
$ go run main.go
This is a summary of the error that will wrap the application error.
for additional info check https://github.com/tfadeyi/my-app/my-app/error_something_code: [something]
```

## License
Go-aloe is released under the [MIT](./LICENSE) License.
